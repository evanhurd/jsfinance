!function t(e,n,r){function i(s,o){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(u)return u(s,!0);var a=new Error("Cannot find module '"+s+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[s]={exports:{}};e[s][0].call(p.exports,function(t){var n=e[s][1][t];return i(n?n:t)},p,p.exports,t,e,n,r)}return n[s].exports}for(var u="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){function r(){i(arguments);this.allowedModels=arguments.length>0?arguments:[],this.items=[],this.SubPub=new f,this.__defineGetter__("length",function(){return this.items.length}),this.sortFunction=null}function i(t){for(var e=0;e<t.length;e++)if("Model"!=t[e].toString())throw t[e].toString()+" is not a valid Model!"}function u(t,e,n){var r=e.Item;t.SubPub.publish("*",n),t.SubPub.publish(n.type,n),t.SubPub.publish(n.type+":"+r.toString(),n),t.SubPub.publish(n.type+":"+r.toString()+"."+n.key,n),t.SubPub.publish(r.toString(),n),t.SubPub.publish(r.toString()+"."+n.key,n)}function s(t,e){var n={collection:t,items:e.items,type:e.type||"Uknown"};return n}function o(t,e){t.SubPub.publish("*",e),t.SubPub.publish(e.type,e)}function l(t){t.__defineGetter__(t.items.length,p.bind(t,t,t.items.length)),t.__defineSetter__(t.items.length,h.bind(t,t,t.items.length))}function a(t){t.items.length>0&&delete t[t.items.length-1]}function p(t,e){return t.items[e]}function h(t,e){return!1}function c(t,e,n){for(var r=t.length,i=0;r>i;i++){var u=n(e,t.items[i]);if(-1==u)return i;if(1!=u)return i+1}return r}function m(t){for(var e=t.items.length-1;e>=0;e--)t.items[e]._previousItem=t.items[e-1]||null,t.items[e]._nextItem=t.items[e+1]||null,t.items[e]._index=e}var f=t("./subpub.js"),d=t("./CollectionItem.js");e.exports=r,r.prototype.on=function(t,e){this.SubPub.subscribe(t,e)},r.prototype.add=function(){for(var t=[],e=0;e<arguments.length;e++){var n=this.__addSingleItem(arguments[e]);n&&t.push(n)}return m(this),t.length>0&&this.event({type:"Add",items:t}),t},r.prototype.event=function(t){o(this,new s(this,t))},r.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++){var n=this.__removeSingleItem(arguments[e]);n&&t.push(n)}return m(this),t.length>0&&this.event({type:"Remove",items:t}),t},r.prototype.toString=function(){return"Collection"},r.prototype.__addSingleItem=function(t){if("CollectionItem"==t.toString()&&(t=t.Item),0==this.isValidItem(t))return!1;var e=new d(t,this);if(l(this),"function"==typeof this.sortFunction){var n=c(this,t,this.sortFunction);this.items.splice(n,0,e)}else this.items.push(e);return e.on("*",u.bind(this,this,e)),e},r.prototype.__removeSingleItem=function(t){var e=this.indexOfItem(t);if(e>-1){var n=this.items[e];return this.items[e].destory(),a(this),this.items.splice(e,1),n}return!1},r.prototype.sort=function(t){return this.sortFunction=t,this.items.sort(t),m(this),setTimeout(function(){this.event({type:"Sort",items:[]})}.bind(this),10),this},r.prototype.indexOfItem=function(t){if("CollectionItem"==t.toString())return this.items.indexOf(t);for(var e=0;e<this.items.length;e++)if(this.items[e].Item==t)return e;return-1},r.prototype.isValidItem=function(t){if("CollectionItem"==t.toString()&&(t=t.Item),0==this.allowedModels.length)return!0;for(var e=0;e<this.allowedModels.length;e++)if(t instanceof this.allowedModels[e])return!0;return!1}},{"./CollectionItem.js":3,"./subpub.js":9}],2:[function(t,e,n){function r(t,e){var n=new p;return n.collection=t,n.itemFunction=e,n.SubPub=t.SubPub.newGroup(),n.knownItems=[],n.SubPub.subscribe("Add",i.bind(n,n)),n.SubPub.subscribe("Remove",u.bind(n,n)),n}function i(t,e){for(var n=0;n<e.items.length;n++)s(t,e.items[n])}function u(t,e){for(var n=0;n<e.items.length;n++)l(t,e.items[n])}function s(t,e){var n=new t.itemFunction(e,new h(e)),r=a(e,t);if(null==r)t.appendChild(n);else{var i=t.children[r];t.insertBefore(n,i)}n.__collectionElementItem=e,e.SortMeta.SubPub.subscribe("_index",o.bind(e,e,n,t))}function o(t,e,n){var r=a(t,n);if(r>=0&&null!=r){var i=n.children[r];n.removeChild(e),n.insertBefore(e,i)}else n.removeChild(e),n.appendChild(e)}function l(t,e){for(var n=0;n<t.children.length;n++)t.children[n].__collectionElementItem==e&&t.removeChild(t.children[n])}function a(t,e){for(var n=t._nextItem;n;){for(var r=0;r<e.children.length;r++)if(e.children[r].__collectionElementItem==n)return r;n=n._nextItem}return null}e.exports=r;var p=t("./ElementCollection.js"),h=t("./ModelValue.js")},{"./ElementCollection.js":4,"./ModelValue.js":6}],3:[function(t,e,n){function r(t,e){this.Item=t,this.Collection=e,this.SubPub=t.SubPub.newGroup(),this.SortMeta={nextItem:null,previousItem:null,index:null,SubPub:new o},this.__defineGetter__("_nextItem",function(){return this.Collection[this.Collection.indexOfItem(this)+1]||null}),this.__defineGetter__("_previousItem",function(){return this.Collection[this.Collection.indexOfItem(this)-1]||null}),this.__defineGetter__("_index",function(){return this.Collection.indexOfItem(this)}),this.__defineSetter__("_nextItem",function(t){this.SortMeta.nextItem!=t&&(this.SortMeta.nextItem=t,this.SortMeta.SubPub.publish("_nextItem",t))}),this.__defineSetter__("_previousItem",function(t){this.SortMeta.previousItem!=t&&(this.SortMeta.previousItem=t,this.SortMeta.SubPub.publish("_previousItem",t))}),this.__defineSetter__("_index",function(t){this.SortMeta.index!=t&&(this.SortMeta.index=t,this.SortMeta.SubPub.publish("_index",t))}),i(this)}function i(t){for(var e=t.Item.Properties.Model.keys,n=0;n<e.length;n++)t.__defineGetter__(e[n],u.bind(t,t,e[n])),t.__defineSetter__(e[n],s.bind(t,t,e[n]))}function u(t,e){return t.Item[e]}function s(t,e,n){t.Item[e]=n}var o=t("./subpub.js");e.exports=r,r.prototype.toString=function(){return"CollectionItem"},r.prototype.on=function(t,e){this.SubPub.subscribe(t,e)},r.prototype.destory=function(){this.SubPub.destroy(),this.Item=void 0,this.SubPub=void 0,delete this.SubPub,delete this.Item}},{"./subpub.js":9}],4:[function(t,e,n){function r(){return this.inState=0,this.placeHolder=document.createComment("ElementCollection"),this.children=[],this.firstChild=null,this.lastChild=null,this.parentElement=null,this}e.exports=r;var i=t("./QuickStep.js");r.prototype.pushin=function(){this.inState=1,this.reInsertNodes()},r.prototype.pullout=function(){this.inState=0;for(var t=this.children.length-1;t>=0;t--)this.children[t].parentElement&&i.remove(this.children[t])},r.prototype.reInsertNodes=function(){if(this.parentElement&&1==this.inState)for(var t=this.placeHolder,e=this.children.length-1;e>=0;e--)this.children[e].parentElement&&i.remove(this.children[e]),i.insertBefore(this.children[e],t),t=this.children[e];return this},r.prototype.remove=function(){return 1==this.inState&&this.pullout(),this.placeHolder.parentElement&&this.placeHolder.parentElement.removeChild(this.placeHolder),this.parentElement=null,this},r.prototype.insert=function(t,e){var e=arguments[1]||!1;return this.placeHolder.parentElement&&this.placeHolder.parentElement.removeChild(this.placeHolder),this.parentElement=t,e?t.insertBefore(this.placeHolder,e):t.appendChild(this.placeHolder),0==this.inState&&this.pushin(),this},r.prototype.appendChild=function(t){t.parentElement||(this.children.push(t),1==this.inState&&i.insertBefore(t,this.placeHolder))},r.prototype.removeChild=function(t){var e=this.children.indexOf(t);e>=0&&(this.children.splice(e,1),i.remove(t))},r.prototype.insertBefore=function(t,e){var n=this.children.indexOf(e);n>=0&&!t.parentElement&&(this.children.splice(n,0,t),1==this.inState&&(e.parentElement==this.parentElement?i.insertBefore(t,e):i.insertBefore(t,this.placeHolder)))},r.prototype.toString=function(){return"ElementCollection"},i.on("ElementCollection",function(t,e,n){return e.insert(n),!1})},{"./QuickStep.js":7}],5:[function(t,e,n){function r(t,e,n){function r(t,e){var n=this,r={};n.Properties=r,n.Event=l.bind(n,n),n.SubPub=new p,n.ParentSubPub=t.SubPub.newGroup(),r.keyValuePair=e||{},r.Model=t,u(n)}return r.keys=e,r.prototype.Settings=n||{},r.modelName=t,r.prototype.toString=function(){return this.Properties.Model.modelName},r.prototype.event=function(t){a(this,new l(this,t))},r.prototype.on=i,r.SubPub=new p,r.on=i,r.__proto__.toString=function(){return"Model"},r.bind({},r)}function i(t,e){this.SubPub.subscribe(t,e)}function u(t){for(var e=0;e<t.Properties.Model.keys.length;e++){var n=t.Properties.Model.keys[e];t.__defineGetter__(n,s.bind(t,t,n)),t.__defineSetter__(n,o.bind(t,t,n))}}function s(t,e){return t.Properties.keyValuePair[e]}function o(t,e,n){t.Properties.keyValuePair[e]=n,t.event({key:e,value:n,oldValue:t.Properties.keyValuePair[e]})}function l(t,e){var n={model:t.Properties.Model,item:t,type:e.type||"Update",key:e.key||"",value:e.value||"",oldValue:e.oldValue||""};return n}function a(t,e){t.SubPub.publish("*",e),t.SubPub.publish(e.key,e),t.SubPub.publish(e.type,e),t.ParentSubPub.publish("*",e),t.ParentSubPub.publish(e.type,e),t.ParentSubPub.publish(e.type+":"+t.toString(),e),t.ParentSubPub.publish(e.type+":"+t.toString()+"."+e.key,e),t.ParentSubPub.publish(t.toString(),e),t.ParentSubPub.publish(t.toString()+"."+e.key,e)}var p=t("./subpub.js");e.exports=r},{"./subpub.js":9}],6:[function(require,module,exports){function ModelValue(t){return"CollectionItem"==t.toString()?(this.metaSubPub=t.SortMeta.SubPub,this.SubPub=t.SubPub,this.item=t,this.modelKeys=t.Item.Properties.Model.keys):(this.metaSubPub=!1,this.SubPub=t.SubPub,this.item=t,this.modelKeys=t.Properties.Model.keys),this.stringTester=new createValueStringTester(this.item,this.modelKeys),Value.bind(this)}function Value(t){var e=this.stringTester.test(t);return{item:this.item,keys:e,modelKeys:this.modelKeys,valueString:t,SubPub:this.SubPub,metaSubPub:this.metaSubPub?this.metaSubPub.newGroup():this.SubPub,stringTester:this.stringTester,toString:function(){return"ModelValue"}}}function createValueStringTester(item,keys){return function(item){var tester={},__currentTestKeys=[];tester.__get=function(t){__currentTestKeys.indexOf(t)<0&&__currentTestKeys.push(t)};for(var i in keys){var key=keys[i];tester.__defineGetter__(key,tester.__get.bind(tester,key))}return tester.__defineGetter__("_index",tester.__get.bind(tester,"_index")),tester.__defineGetter__("_previousItem",tester.__get.bind(tester,"_previousItem")),tester.__defineGetter__("_nextItem",tester.__get.bind(tester,"_nextItem")),tester.test=function(valueString){with(__currentTestKeys=[],this)eval(valueString);return __currentTestKeys},tester}(item)}function bindKeys(t,e,n,r){for(var i in t.keys){var u=t.keys[i];"_index"==u||"_previousItem"==u||"_nextItem"==u?t.metaSubPub.subscribe(u,e.bind(t,t,n,r)):t.item.on(u,e.bind(t,t,n,r))}}function evaluateValueString(item,valueString){with(item)return eval(valueString)}function updateTextNode(t,e){e.nodeValue=evaluateValueString(t.item,t.valueString)}function updateStyle(t,e,n){e.style[n]=evaluateValueString(t.item,t.valueString)}function updateAttribute(t,e,n){e.setAttribute(n,evaluateValueString(t.item,t.valueString))}function updateClass(t,e){e.setAttribute("class",evaluateValueString(t.item,t.valueString))}function applyEventToTarget(t,e,n){}module.exports=ModelValue;var QuickStep=require("./QuickStep.js");QuickStep.on("ModelValue",function(t,e,n){var r=evaluateValueString(e.item,e.valueString),i=document.createTextNode(r);return bindKeys(e,updateTextNode,i,null),n.appendChild(i),!1}),QuickStep.on("element.object.style.*=ModelValue",function(t,e,n,r){return bindKeys(e,updateStyle,n,r),updateStyle(e,n,r),!1}),QuickStep.on("element.object.attribute.*=ModelValue",function(t,e,n,r){return bindKeys(e,updateStyle,n,r),!1}),QuickStep.on("element.object.class=ModelValue",function(t,e,n,r){return bindKeys(e,updateClass,n),n.setAttribute("class",evaluateValueString(e.item,e.valueString)),!1}),QuickStep.on("element.object.change=ModelValue",function(t,e,n,r){return applyEventToTarget(),!1})},{"./QuickStep.js":7}],7:[function(t,e,n){var r={listeners:{array:[],object:[],string:[],number:[],element:[],other:{}},on:function(t,e){switch(t){case"array":r.listeners.array.push({method:e});break;case"object":r.listeners.object.push({method:e});break;case"string":r.listeners.string.push({method:e});break;case"number":r.listeners.number.push({method:e});break;case"element":r.listeners.element.push({method:e});break;default:return void 0===r.listeners.other[t]&&(r.listeners.other[t]=[]),r.listeners.other[t].push(e),r}return r},apply:function(t,e){t="string"===r.getType(t)?document.createElement(t):t;for(var n=0;n<e.length;n++)r.trigger(r.getType(e[n]),e[n],t);return t},insertBefore:function(t,e){return r.trigger(r.getType(e)+"<"+r.getType(t),t,e),t},remove:function(t){return r.trigger("-"+r.getType(t),t,t),t},append:function(t,e){return r.trigger(r.getType(t),t,e),t},trigger:function(t,e,n){var i=arguments[3];if(r.listeners[t]){for(var u=r.listeners[t].length-1;u>=0;u--)if(listener=r.listeners[t][u],"function"==typeof listener.method&&listener.method.call(n,t,e,n,i)===!1)return r}else if(void 0!==r.listeners.other[t])for(var u=r.listeners.other[t].length-1;u>=0;u--)if(method=r.listeners.other[t][u],"function"==typeof method&&method.call(n,t,e,n,i)===!1)return r},getType:function(t){if(void 0===t)return void 0;if(null===t)return null;if(t&&8==t.nodeType)return"element";if("object"==typeof t&&t.tagName&&t._localName)return"element";var e={}.toString.call(t).match(/([a-zA-Z]+)/)[1],n={}.toString.call(t).match(/\s([a-zA-Z]+)/)[1];return e&&n&&"object"==e.toLowerCase()&&n.toLowerCase().search("element")>0?"element":"object"==typeof t&&""!=t.toString()&&t.toString()!={}.toString()?t.toString():n.toLowerCase()},a:function(){return this.apply("a",arguments)},abbr:function(){return this.apply("abbr",arguments)},acronym:function(){return this.apply("acronym",arguments)},address:function(){return this.apply("address",arguments)},applet:function(){return this.apply("applet",arguments)},area:function(){return this.apply("area",arguments)},b:function(){return this.apply("b",arguments)},base:function(){return this.apply("base",arguments)},basefont:function(){return this.apply("basefont",arguments)},bdo:function(){return this.apply("bdo",arguments)},big:function(){return this.apply("big",arguments)},blockquote:function(){return this.apply("blockquote",arguments)},body:function(){return this.apply("body",arguments)},br:function(){return this.apply("br",arguments)},button:function(){return this.apply("button",arguments)},caption:function(){return this.apply("caption",arguments)},center:function(){return this.apply("center",arguments)},cite:function(){return this.apply("cite",arguments)},code:function(){return this.apply("code",arguments)},col:function(){return this.apply("col",arguments)},colgroup:function(){return this.apply("colgroup",arguments)},dd:function(){return this.apply("dd",arguments)},del:function(){return this.apply("del",arguments)},dfn:function(){return this.apply("dfn",arguments)},dir:function(){return this.apply("dir",arguments)},div:function(){return this.apply("div",arguments)},dl:function(){return this.apply("dl",arguments)},dt:function(){return this.apply("dt",arguments)},em:function(){return this.apply("em",arguments)},fieldset:function(){return this.apply("fieldset",arguments)},font:function(){return this.apply("font",arguments)},form:function(){return this.apply("form",arguments)},frame:function(){return this.apply("frame",arguments)},frameset:function(){return this.apply("frameset",arguments)},h1:function(){return this.apply("h1",arguments)},h2:function(){return this.apply("h2",arguments)},h3:function(){return this.apply("h3",arguments)},h4:function(){return this.apply("h4",arguments)},h5:function(){return this.apply("h5",arguments)},h6:function(){return this.apply("h6",arguments)},head:function(){return this.apply("head",arguments)},hr:function(){return this.apply("hr",arguments)},html:function(){return this.apply("html",arguments)},i:function(){return this.apply("i",arguments)},iframe:function(){return this.apply("iframe",arguments)},img:function(){return this.apply("img",arguments)},input:function(){return this.apply("input",arguments)},ins:function(){return this.apply("ins",arguments)},isindex:function(){return this.apply("isindex",arguments)},kbd:function(){return this.apply("kbd",arguments)},label:function(){return this.apply("label",arguments)},legend:function(){return this.apply("legend",arguments)},li:function(){return this.apply("li",arguments)},link:function(){return this.apply("link",arguments)},map:function(){return this.apply("map",arguments)},menu:function(){return this.apply("menu",arguments)},meta:function(){return this.apply("meta",arguments)},noframes:function(){return this.apply("noframes",arguments)},noscript:function(){return this.apply("noscript",arguments)},object:function(){return this.apply("object",arguments)},ol:function(){return this.apply("ol",arguments)},optgroup:function(){return this.apply("optgroup",arguments)},option:function(){return this.apply("option",arguments)},p:function(){return this.apply("p",arguments)},param:function(){return this.apply("param",arguments)},pre:function(){return this.apply("pre",arguments)},q:function(){return this.apply("q",arguments)},s:function(){return this.apply("s",arguments)},samp:function(){return this.apply("samp",arguments)},script:function(){return this.apply("script",arguments)},select:function(){return this.apply("select",arguments)},small:function(){return this.apply("small",arguments)},span:function(){return this.apply("span",arguments)},strike:function(){return this.apply("strike",arguments)},strong:function(){return this.apply("strong",arguments)},style:function(){return this.apply("style",arguments)},sub:function(){return this.apply("sub",arguments)},sup:function(){return this.apply("sup",arguments)},table:function(){return this.apply("table",arguments)},tbody:function(){return this.apply("tbody",arguments)},td:function(){return this.apply("td",arguments)},textarea:function(){return this.apply("textarea",arguments)},tfoot:function(){return this.apply("tfoot",arguments)},th:function(){return this.apply("th",arguments)},thead:function(){return this.apply("thead",arguments)},title:function(){return this.apply("title",arguments)},tr:function(){return this.apply("tr",arguments)},tt:function(){return this.apply("tt",arguments)},u:function(){return this.apply("u",arguments)},ul:function(){return this.apply("ul",arguments)}};r.on("element",function(t,e,n){return n.appendChild(e),!1}),r.on("-element",function(t,e,n){return e.parentElement&&e.parentElement.removeChild(e),!1}),r.on("element<element",function(t,e,n){return n.parentElement&&n.parentElement.insertBefore(e,n),!1}),r.on("string",function(t,e,n){return n.appendChild(document.createTextNode(e)),!1}),r.on("number",function(t,e,n){return n.appendChild(document.createTextNode(e)),!1}),r.on("array",function(t,e,n){return r.apply(n,e),!1}),r.on("object",function(t,e,n){for(var i in e)r.trigger(r.getType(n)+".object."+i+"="+r.getType(e[i]),e[i],n);return!1}),r.on("[object Arguments]",function(t,e,n){for(var i=[],u=0;u<e.length;u++)i.push(e[u]);return r.apply(n,i),!1}),r.on("element.object.style=object",function(t,e,n){for(var i in e){var t=r.getType(e[i]);"string"==t||"number"==t?n.style[i]=e[i]:(r.trigger("element.object.style."+i+"="+t,e[i],n),r.trigger("element.object.style.*="+t,e[i],n,i))}return!1}),r.on("element.object.attribute=object",function(t,e,n){for(var i in e){var t=r.getType(e[i]);"string"==t||"number"==t?n.setAttribute(i,e[i]):(r.trigger("element.object.attribute."+i+"="+t,e[i],n),r.trigger("element.object.attribute.*="+t,e[i],n,i))}return!1}),r.on("element.object.attr=object",function(t,e,n){for(var i in e){var t=r.getType(e[i]);"string"==t||"number"==t?n.setAttribute(i,e[i]):(r.trigger("element.object.attribute."+i+"="+t,e[i],n),r.trigger("element.object.attribute.*="+t,e[i],n,i))}return!1}),r.on("element.object.parent=element",function(t,e,n){return r.apply(e,[n]),!1}),r.on("element.object.class=string",function(t,e,n){return n.className=e,!1}),r.on("element.object.html=string",function(t,e,n){return n.innerHTML=e,!1}),r.on("element.object.id=string",function(t,e,n){return n.setAttribute("id",e),!1}),r.on("element.object.type=string",function(t,e,n){return n.setAttribute("type",e),!1}),r.on("element.object.value=string",function(t,e,n){return n.setAttribute("value",e),!1}),e.exports=r},{}],8:[function(t,e,n){var r=t("./QuickStep.js"),i=t("./Model.js"),u=t("./Collection.js"),s=t("./CollectionElement.js"),o=t("./ModelValue.js");r.Model=i,r.Collection=u,r.CollectionElement=s,r.ModelValue=o,e.exports=r,window&&(window.QuickStep=r)},{"./Collection.js":1,"./CollectionElement.js":2,"./Model.js":5,"./ModelValue.js":6,"./QuickStep.js":7}],9:[function(t,e,n){function r(){return this.events={},this.groups=[[]],l++,this.id=l,this.newGroup=function(){return this.groups.push([]),{subscribe:i.bind(this,this,this.groups.length-1),publish:u.bind(this,this),unsubscribe:s.bind(this,this,this.groups.length-1),destroy:o.bind(this,this,this.groups.length-1)}},this.subscribe=i.bind(this,this,0),this.publish=u.bind(this,this),this.unsubscribe=s.bind(this,this,0),this.destroy=o.bind(this,this,0),this}function i(t,e,n,r){return void 0==t.events[n]&&(t.events[n]=[]),t.events[n].indexOf(r)>-1?!1:(t.events[n].push(r),void t.groups[e].push(r))}function u(t,e,n){if(void 0!=t.events[e]&&t.events[e].length>0)for(var r=t.events[e],i=0;i<r.length;i++)r[i](n)}function s(t,e,n,r){void 0!=t.groups[e]&&t.groups[e].length>0&&t.groups[e].splice(t.groups[e].indexOf(r),1),void 0!=t.events[n]&&t.events[n].length>0&&t.events[n].splice(t.events[n].indexOf(r),1)}function o(t,e){if(t.groups[e]){for(var n=t.groups[e],r=0;r<n.length;r++)for(event in t.events){var i=t.events[event].indexOf(n[r]);i>-1&&t.events[event].splice(i,1)}t.groups[e]=null}}e.exports=r;var l=0},{}]},{},[8]);
